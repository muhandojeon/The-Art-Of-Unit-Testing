# ê²©ë¦¬ í”„ë ˆì„ì›Œí¬
* ê²©ë¦¬ í”„ë ˆì„ì›Œí¬ë€ ëŸ°íƒ€ì„ì— ê°€ì§œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ì„¤ì •í•  ìˆ˜ ìˆëŠ” ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì˜ë¯¸
* ì´ëŸ¬í•œ ê°ì²´ëŠ” ë™ì  ìŠ¤í…ê³¼ ë™ì  ëª©ì´ë¼ê³  í•¨

## ëŠìŠ¨í•œ íƒ€ì… ëŒ€ ì •ì  íƒ€ì…

* ìë°”ìŠ¤í¬ë¦½íŠ¸ê°€ ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° íŒ¨ëŸ¬ë‹´ìœ¼ì„ ì§€ì›í•´, ë‘ ê°€ì§€ ìœ í˜•ìœ¼ë¡œ ê²©ë¦¬ í”„ë ˆì„ì›Œí¬ë¥¼ ë‚˜ëˆŒ ìˆ˜ ìˆìŒ

* ëŠìŠ¨í•œ íƒ€ì…
  + ì œìŠ¤íŠ¸
  + ì„¤ì •ê³¼ ë³´ì¼ëŸ¬ í”Œë ˆì´íŠ¸ ì½”ë“œê°€ ë” ì ê²Œ í•„ìš”í•¨ -> í•¨ìˆ˜í˜•ì— ì í•©
* ì •ì  íƒ€ì…
  + subsitute.js
  + ì „ì²´ í´ë˜ìŠ¤ì™€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë‹¤ë£° ë•Œ ìœ ìš©

* ì–´ë–¤ ìœ í˜•ì„ ì‚¬ìš©í• ì§€ëŠ” ì·¨í–¥, ìŠ¤íƒ€ì¼, ê°€ë…ì„± ì¸¡ë©´ì—ì„œ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì§€ë§Œ **ì–´ë–¤ ì¢…ë¥˜ì˜ ì˜ì¡´ì„±ì„ ê°€ì§œë¡œ ë§Œë“¤ì–´ì•¼ í•˜ëŠ”ê°€ê°€ ë” ì¤‘ìš”í•œ ê´€ì **
  + ëª¨ë“ˆ ì˜ì¡´ì„±
  + í•¨ìˆ˜í˜• ì˜ì¡´ì„±
  + ê°ì²´ ì „ì²´, ê°ì²´ ê³„ì¸µ êµ¬ì¡°, ì¸í„°í˜ì´ìŠ¤

> vitestëŠ” ëŠìŠ¨í•œ íƒ€ì…ì˜ toMocked, spyOn APIë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ê¶Œì¥í•¨
> https://vitest.dev/guide/mocking#classes

## ëŠìŠ¨í•œ íƒ€ì…ìœ¼ë¡œ ë™ì  ê°€ì§œ ëª¨ë“ˆ ë§Œë“¤ê¸°

```ts
// stub
jest.mock('./foo-path');

const stubFoo = require('./foo-path');

describe('foo', () => {
  afterEach(jest.resetAllMocks);
  
  test('foo', () => {
    stubFoo.someFunction.mockReturnValue('bar');
  })
})

// mock
jest.mock('./foo-path');

const mockFoo = require('./foo-path');

describe('foo', () => {
  afterEach(jest.resetAllMocks);

  test('foo', () => {
    expect(mockFoo.someFunction()).toHaveBeenCalledWith(stringMatching(/^foo/));
  })
})

```

> vitestëŠ” .mock, .doMock, , mocked APIê°€ ìˆìŒ
>
> .mockì€ í•´ë‹¹ ëª¨ë“ˆì´ exportí•˜ëŠ” ëª¨ë“ˆì„ ì „ë¶€ ëª¨í‚¹
> í˜¸ì´ìŠ¤íŠ¸ë˜ì–´ ì–´ë””ì„œ ì„ ì–¸ë˜ëŠ”ì§€ ì¤‘ìš”í•˜ì§€ ì•ŠìŒ
>
> .doMockì€ .mockê³¼ ë™ì¼í•˜ì§€ë§Œ ì‚¬ìš©í•œ ì´í›„ë¶€í„° ëª¨í‚¹
>
> .mockedëŠ” í•´ë‹¹ ëª¨ë“ˆì˜ íŠ¹ì • í•¨ìˆ˜ë§Œ ëª¨í‚¹
>
> https://vitest.dev/api/vi.html#vi-mock

### ì§ì ‘ ì˜ì¡´ì„±ì˜ ì¶”ìƒí™” ê³ ë¯¼

```ts
// êµ¬í˜„ì²´
import { foo } from 'some-packages';

export function foobar() {
  foo();
}

// í…ŒìŠ¤íŠ¸ 
jest.mock('some-packages');
```

* ìœ„ ê²½ìš°ì— ëª¨ë“ˆì˜ ì›ë˜ API ì„¤ê³„ê°€ í…ŒìŠ¤íŠ¸ êµ¬í˜„ì— ë°€ì ‘í•˜ê²Œ ê²°í•©ë˜ì–´ APIê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ìˆ˜ë§ì€ í…ŒìŠ¤íŠ¸ë¥¼ í•¨ê»˜ ë³€ê²½í•´ì•¼ í•¨

* ì´ë¥¼ ìœ„í•´ ì–´ëŒ‘í„° íŒŒì¼ì„ ë§Œë“¤ì–´, ì¶”ìƒí™”í•˜ëŠ” ë°©ë²•ì„ ê¶Œì¥í•¨

> ì™ì™ í•¨ìˆ˜í˜•ì—ì„œ ë§í–ˆë˜ ì¶”ìƒí™” ë²½ì„ ë‘ëŠ” ë°©ë²•

> í˜„ì‹¤ ì„¸ê³„ì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì´ë¼ê³  ìƒê°í•¨
> í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ê²ƒë„ ìˆì§€ë§Œ, ì¨ë“œ íŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ëŒ€í•œ ì˜ì¡´ì„±ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•¨ì´ í¼ (ê° ì ìœ¼ë¡œ)
>
> í˜„ì‹¤ ì„¸ê³„ì—ì„œ ìˆ«ì ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë©í•‘í•´ì„œ ì‚¬ìš©í•˜ê³  ìˆìŒ
> > ì•„ë˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ìœˆë„ìš° 10, ì›¨ì¼, êµ¬í˜• ì‚¬íŒŒë¦¬ ë“±ì„ í•¸ë“¤ë§í•˜ê³  ìˆì§€ ëª»í•´ì„œ ã…‡ã…‡ ...
> > ë””ë²„ê¹…í•œ ê³¼ì •ë„ ì¬ë°ŒëŠ”ë°, ë¸Œë¼ìš°ì € ìŠ¤íƒ ê³µìœ í•´ë“œë¦´ê²Œì—¬
> dateë„ ..

```ts
import NumberFlow, { useCanAnimate } from '@number-flow/react';

export const SafeNumberFlow = memo(
  forwardRef<ElementRef<typeof NumberFlow>, Props>(function SafeNumberFlow(
    { value, ...props },
    ref,
  ) {
    const canAnimate = useCanAnimate();

    return (
      <ErrorBoundary fallback={<Fallback value={value} {...props} />}>
        <NumberFlow animated={canAnimate} value={value} ref={ref} {...props} />
      </ErrorBoundary>
    );
  }),
);
```

## Substitute

```ts
const mockLog = Substitute.for<ComplicatedInterface>();

mockLog.received().info(Arg.is(x => x.includes('foo')));
```

* ê°ì²´ì˜ ì‹œê·¸ë‹ˆì²˜ì— ìƒˆë¡œìš´ í•¨ìˆ˜ê°€ ì¶”ê°€ë˜ë”ë¼ë„ í…ŒìŠ¤íŠ¸ë¥¼ ê±°ì˜ ë³€ê²½í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ì´ì 

> https://github.com/ffMathy/FluffySpoon.JavaScript.Testing.Faking
> https://npmtrends.com/@fluffy-spoon/substitute
> í™•ì¸í•´ë³´ë‹ˆ ë‹¤ìš´ë¡œë“œ ìˆ˜ë„ ë§ì§€ ì•Šê³  ... ë©”ì¸í…Œì´ë‹ì´ ì˜ ë˜ê³  ìˆì§€ ì•Šì€ ê±° ê°™ìŒ
>
> ì›ë³¸ ì‹œê·¸ë‹ˆì²˜ë¥¼ ìœ ì§€í•˜ê³ , ì›í•˜ëŠ” ë¶€ë¶„ë§Œ ëª¨í‚¹í•˜ëŠ” ê±´ vitest APIì—ì„œë„ ì§€ì›í•˜ë‹ˆ êµ³ì´ ì“¸ í•„ìš”ê°€ ìˆì„ê¹Œ ...
> https://vitest.dev/api/vi.html#vi-importactual

## ë™ì  ìŠ¤í…

* mockReturnValue
* mockReturnValueOnce

* ì˜¤ë¥˜ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê±°ë‚˜ ë” ë³µì¡í•œ ì‘ì—…ì„ í•´ì•¼í•  ê²½ìš°
  + mockImplementation
  + mockImplementationOnce

## ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ëª¨ì˜ ê°ì²´ê°€ í•„ìš”í•˜ì§€ ì•Šë‹¤

* ê²©ë¦¬ í”„ë ˆì„ì›Œí¬ì˜ ê°€ì¥ ìœ„í—˜í•˜ë©´ì„œë„ ë¬´ì‹œí•˜ê¸° í˜ë“  í•¨ì •ì€ ë¬´ì—‡ì´ë“  ì‰½ê²Œ ê°€ì§œë¡œ ë§Œë“¤ ìˆ˜ ìˆë‹¤ëŠ” ê²ƒ
  + ì• ì´ˆì— ëª¨ì˜ ê°ì²´ê°€ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ê²Œ ë¨ 

* í…ŒìŠ¤íŠ¸ ê°€ë…ì„±ì´ ë–¨ì–´ì§€ê³  ìˆë‹¤ê³  ëŠë‚€ë‹¤ë©´ ëª©ì´ë‚˜ ê²€ì¦ ë‹¨ê³„ë¥¼ ì¤„ì´ëŠ” ê²ƒë„ í•˜ë‚˜ì˜ ë°©ë²•
  + ë˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë” ì‘ì€ í•˜ìœ„ í…ŒìŠ¤íŠ¸ë¡œ ìª¼ê°œì„œ ì „ì²´ì ì¸ ê°€ë…ì„±ì„ ëŒì–´ì˜¬ë¦¬ëŠ” ê²ƒì„ ê³ ë¯¼í•´ë³´ì

## ì˜ëª»ëœ ëŒ€ìƒ ê²€ì¦

* í…ŒìŠ¤íŠ¸ì— ì…ë¬¸í•˜ëŠ” ì‚¬ëŒë“¤ì´ í”í•˜ê²Œ ì €ì§€ë¥´ëŠ” ì‹¤ìˆ˜ëŠ” ì‹¤ì œë¡œ ì˜ë¯¸ ìˆëŠ” ë™ì‘ì„ ê²€ì¦í•˜ê¸° ë³´ë‹¤ëŠ” ë‹¨ì§€ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ê²€ì¦ì„ í•˜ëŠ” ê²ƒ

> ì™„ì „ ì €ê²©ë‹¹í–ˆìŒ
> ì €ëŠ” ì»¤ë²„ë¦¬ì§€ë¥¼ ë†’ì´ë ¤ê³  ë°°ëŸ´ íŒŒì¼ í…ŒìŠ¤íŠ¸í•˜ê¸°ë„ í–ˆìŒ ã…‹ã…‹ã…‹
> https://vitest.dev/api/expect#tobedefined
>
> ì´ assertionì€ ì–´ëŠ ê²½ìš°ì— ì¢‹ì„ê¹Œ ... í•„ìš”í• ê¹Œ ... ğŸ¤”

```ts
// index.ts
import { foo } from './foo';

// index.test.ts
import { foo } from './index';

test('foo is defined', () => {
  expect(foo).toBeDefined('foo');
})
```

## ìš”ì•½

* ë‚´ë¶€ êµ¬í˜„ ì„¸ë¶€ ì‚¬í•­ì„ ì¶”ì¸¡í•˜ê±°ë‚˜ ì˜ì¡´í•˜ì§€ ì•Šë„ë¡ í•˜ê¸° ìœ„í•´ ê°€ëŠ¥í•œ í•œ ìƒí˜¸ ì‘ìš© í…ŒìŠ¤íŠ¸ë³´ë‹¤ëŠ” ë°˜í™˜ ê°’ì´ë‚˜ ìƒíƒœ ê¸°ë°˜ í…ŒìŠ¤íŠ¸ë¥¼ ì‚¬ìš©í•˜ì
* ëª©ì€ ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œëŠ” í…ŒìŠ¤íŠ¸í•  ìˆ˜ ì—†ì„ ë•Œë§Œ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ìœ ì§€ ë³´ìˆ˜ê°€ ì–´ë ¤ìš´ í…ŒìŠ¤íŠ¸ê°€ ë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤
