# 8장 유지 보수성

테스트 유지 보수성을 높이는 방법 소개

## 테스트 실패로 코드 변경

### 프로덕션 코드의 API 변경

팩토리 함수로 객체를 만드는 과정을 분리해야 한다.  
테스트할 코드의 생성 과정을 분리하거나 추상화하면 생성자의 변경 사항을 중앙에서만 처리하면 된다.  
객체를 생성하고 미리 설정하는 함수를 팩토리 함수 또는 팩토리 메서드라고 한다.  
이게 더 발전한 패턴은 객체의 어머니(Object Mother) 패턴이다.

### 다른 테스트가 변경되었을 경우

테스트가 독립적이지 않고 서로 영향을 주면 문제가 발생한다.  
같은 기능을 검증하더라도 각 테스트는 서로 격리된 공간에서 실행해야 한다.

순서가 정해진 테스트 = 어떤 테스트가 이전 테스트의 여부에 실행 따라 결과가 달라지는 상황  
메모리 내 공유 변수나 데이터베이스 같은 외부 자원을 변경하고 다른 테스트가 그 변수 값을 참조한다면, 두 테스트는 실행 순서에 영향을 받는다.  
대부분의 테스트 러너는 테스트를 항상 특정 순서로 실행하지 않는다.  
테스트가 이전과 동일한 순서로 실행되지 않을 수 있다는 의미다.  

코드에서 공유하는 변수/함수 등이 있을 때는 `beforeEach()`나 `afterEach()` 함수를 사용하여 테스트 실행 전이나 후에 초기 상태로 리셋해야 한다.

## 유지 보수성을 높이는 리팩터링 방법

### private 또는 protected 메서드 사용하지 않기

private 또는 protected 메서드는 보통 특정한 이유로 메서드에 대한 접근을 제한하는 용도로 사용한다.  
이는 구현 세부 사항을 숨겨 나중에 구현이 변경되더라도 외부에서 보이는 동작은 바뀌지 않도록 하기 위함이다.

private 메서드는 홀로 존재하지 않고 결국 호출해야만 실행된다.  
private 메서드 = 외부 인터페이스로 시작하는 더 큰 작업의 일부  
그래서 private 메서드를 보면 시스템 내에서 이 메서드를 호출하는 부분을 찾아야 한다.

시스템의 외부 동작, 즉 public 메서드가 올바르게 작동하는지 확인하는 게 중요하다.  
private 메서드를 테스트한다면 해당 메서드를 public/static 메서드로 바꾸거나 최소한 내부 메서드로 변경하는 것이 좋다.  
public 메서드에 대한 테스트를 작성하고, public 메서드가 더 작은 private 메서드를 호출하도록 리팩터링한다.

private 메서드는 테스트하지 않는 것이 좋으며, 외부에서 관찰할 수 있는 동작을 검증해야 한다.  
private 메서드를 테스트해야 한다는 것은 추상화가 부족하다는 신호일 수 있으며,  
이는 해당 메서드를 public으로 만들거나 별도의 클래스로 분리해야 한다는 의미다.

### 테스트에서도 DRY 원칙 고수

DRY 원칙은 소프트웨어 개발에서 동일한 코드나 로직을 반복하지 말라는 것이다.  
헬퍼 함수를 사용하면 테스트 중복 부분을 줄일 수 있다.  
준비(arrange)와 검증(assert)부분에서 반복되는 세부 사항을 헬퍼 메서드로 추상화해야 한다.

### 초기화 함수를 사용하지 않기

중복 제거를 목적으로 각 테스트 전에 한 번씩 실행하는 `beforeEach()` 함수(= 초기화 함수)보다  
가급적이면 팩토리 메서드와 헬퍼 함수를 사용하는 것이 좋다.

### 매개변수화된 테스트로 중복 코드 제거

여러 언어의 다양한 테스트 프레임워크에서 매개변수화된 테스트를 지원한다.  
ex. 제스트 사용 시 `test.each()`나 `it.each()`  

매개변수화 패턴 = `beforeEach()`에 있어야 할 설정 로직을 각 테스트의 준비(arrange)단계로 옮기는 것     
테스트 간 코드 중복을 줄일 수 있지만, 동일한 테스트 시나리오에서는 입력 값과 결과 값이 다를 때만 사용하도록 주의한다.

## 과잉 명세된 테스트

### 목을 사용한 내부 동작 과잉 명세

작업 단위의 종료점 대신 함수 호출만 검증하는 것은 안티 패턴이다.  
메서드가 값을 반환한다면 그 메서드를 모의 함수로 만들지 않는 편이 좋다.
