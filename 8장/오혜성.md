# 유지 보수성

유지 보수성이 테스트를 얼마나 자주 변경해야 하는지 가늠하는 척도라면 그 횟수를 최소화하는 것이 중요하다.

이를 위해 다음 항목을 점검해 볼 필요가 있다
* 언제 테스트가 실패하여 변경이 필요하다는 사실을 깨닫는가?
* 왜 테스트가 실패하는가?
* 어떤 테스트가 실패했을 때 테스트 코드를 반드시 수정해야 하는가?
* 테스트 코드를 반드시 수정할 필요가 없더라도 언제 코드를 변경하는가?

## 테스트 실패로 코드 변경

* 실제 버그로 발생한 실패 = 실제 실패 / 프로덕션 코드의 버그가 아닌 다른 이유로 발생하는 실패 = 거짓 실패

* 테스트의 유지 보수성을 측정하려면 일정 기간 동안 발생하는 거짓 실패 횟수와 그 원인을 분석하는 것부터 시작할 수 있다.

* 팩토리 함수로 객체를 만드는 과정을 분리해야 한다
  + 유지 보수성을 떨어뜨릴 수 있는 잠재적인 문제 상황을 피하는 방법은 테스트할 코드의 생성 과정을 분리하거나 추상화하는 것이다.

> https://martinfowler.com/bliki/ObjectMother.html
> 정리내용

```
Object Mother란?

테스트에 필요한 예제 객체(테스트 픽스처)를 생성하는 데 사용되는 클래스
이름은 2000년대 초 Thoughtworks 프로젝트에서 만들어짐

필요성

큰 시스템에서 테스트할 때 많은 예제 데이터가 필요함
단순한 객체가 아닌 여러 관련 정보(예: 직원의 결혼 상태, 부양가족 수, 고용 이력 등)가 포함된 복잡한 객체 필요

사용 방법

여러 테스트 클래스에서 유사한 데이터가 필요할 때 표준 픽스처를 반환하는 팩토리 객체로 사용
각 클래스마다 다른 Mother 객체를 만들 수 있음 (예: CustomerMother, ProductMother 등)
미리 정의된 객체(예: 'John', 'Heather')를 제공하여 팀이 친숙하게 사용 가능

장점

테스트 코드에서 반복적인 데이터 생성 코드 제거
팀 내에서 공통된 예제 객체에 대한 이해 형성
기존 객체를 약간 수정하여 다양한 테스트 시나리오 구현 가능

단점

많은 테스트가 Mother 객체의 정확한 데이터에 의존하므로 결합도가 높음
표준 데이터 변경 시 많은 테스트에 영향을 미칠 수 있음
Object Mother 패턴은 테스트 코드를 더 깔끔하고 이해하기 쉽게 만들지만, 데이터 변경 시 발생할 수 있는 유지보수 문제를 고려해야 합니다.

```

> 진짜 같은 스텁 데이터 제공 라이브러리 https://fakerjs.dev

## 유지 보수성을 높이는 리팩터링 방법

### private 또는 protected 메서드 사용하지 않기

* 우리는 집 내부가 아닌 외부 모습만 신경 쓰면 된다
* TDD에서는 보통 public 메서드에 대한 테스트를 작성하고, 그런 여러 public 메서드가 나중에 더 작은 private 메서드를 호출하도록 리팩터링한다.
  + 이 과정에서 public 메서드에 대한 테스트는 계속 통과해야 한다.

### 테스트에서도 DRY 원칙 고수

* 단위 테스트에서 중복은 프로덕션 코드에서의 중복만큼이나 아니 그 이상으로 개발자에게 좋지 않은 영향을 줄 수 있다.

> 프로덕션 코드에서 DRY를 고려할 위치와 상황을 잘 고려해야 한다고 생각함. 어떨 때는 WET한게 변경에 대응하기 쉽다고 생각함

### 초기화 함수를 사용하지 않기

* beforeEach에 초기화 작업을 넣지 말고, 초기화하는 함수를 사용하자

> 이 라이브러리에서는 이에 반하게 되어 있는데, 코드 조각이 짧긴 해서 나쁘다고는 생각이 들진 않지만 초기화 함수를 만드는게 더 깔끔하긴 했을듯?
> https://github.com/imbhargav5/rooks/blob/main/packages/rooks/src/__tests__/useInput.spec.tsx

## 과잉 명세된 테스트

* 과잉 명세(overspecification)된 테스트는 단순히 코드의 외부 동작을 확이한느 것이 아니라, 코드 내부가 어떻게 구현되어야 하는지까지 검증하는 테스트를 의미함

> 진입점과 종료점으로 테스트를 하라 ~

* 메서드 호출 자체는 종료점을 나타내지 않는다

## 결과와 순서를 지나치게 세밀하게 검증

* 한 번에 모든 것을 검증하려고 하지 말고, 검증을 여러 작은 검증 구문으로 나누어 각각의 측면을 명확하게 확인하는 것이 좋다.

* 문자열이 정확히 일치하는지 확인하지말자
  + 문자열은 사용자 인터페이스의 한 형태로 시간이 지나면서 약간씩 수저오디거나 다듬어진다
  + 실제로 중요한 것을 테스트하자

## 요약

* 테스트가 장기적으로도 가치가 있으려면 정말로 비즈니스에서 중요하게 생각하는 부분에서만 납득 가능한 이유로 실패해야 한다

* private 메서드는 테스트하지 않는 것이 좋다. 
  + 내부 구현의 일부이기 때문에 이를 테스트하면 테스트가 불안정해질 수 있다
  + 테스트는 최종 사용자에게 중요한 외부에서 관찰할 수 있는 동작을 검증해야 한다

* 과잉 명세를 조심해야 한다
