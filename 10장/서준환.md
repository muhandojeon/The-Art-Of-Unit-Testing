# 10장 더 나은 테스트 전략 수립

테스트 수준이 높을수록 실제 의존성을 더 많이 사용, 신뢰도는 높음
but 느려지고 불안정해질 수 있음

## 기준

필자는 아래의 항목을 기준으로 테스트 전략에 대한 평가를 함.

- 복잡성
- 불안정성
- 테스트 통과 신뢰도
- 유지 보수성
- 실행 속도

## 테스트 정리

### 단위 테스트와 컴포넌트 테스트

단위 테스트와 컴포넌트 테스트는 어떨까?

- 복잡하지 않음
- 불안정하지 않음
- 테스트 통과 신뢰도 낮음 (전체적인 시스템이 잘 동작하는지 확인은 어려움)
- 유지 보수 쉬움
- 실행 속도 빠름

컴포넌트 테스트는 단위 테스트보다 더 많은 함수나 컴포넌트를 작업 단위 내에 포함할 수 있으므로 조금 더 높은 수준이라 볼 수 있음

다만, 추상화 수준에 따라 통합 테스트인지 헷갈릴 수도 있다고 생각한다. 요것은 **외부 의존성**이 있는지에 따라 결정되므로 외부 의존성이 있는 경우 통합 테스트로 간주할 수 있음

### 통합 테스트

일반적인 단위 테스트와 비슷하게 보이지만, 일부 의존성을 스텁으로 대체할 수 없는 경우가 있다.

DB or 외부 서비스 등등,,

통합 테스트는 아래와 같다.

- 불안정성 중간 (실제 의존성 수에 따라 결정)
- 신뢰도 중간
- 유지 보수 중간 (외부 의존성을 사용하기에 단위 테스트보단 복잡함)
- 실행 속도 중간 (외부 의존성 때문에 단위 테스트보다 느림)

### API 테스트

이건 잘 와닿지 않아서,,

### E2E 격리 테스트

E2E 테스트를 하는데, 특정 서비스에 대해선 스텁이나 모킹을 진행하여 원하는 부분만 따로 테스트하는 것을 말한다.

- 불안정성 높음
- 신뢰도 높음
- 유지 보수 어려움
- 실행 속도 느림

### E2E 시스템 테스트

E2E 시스템 테스트는 실제 시스템을 테스트하는 것이다.

가짜인 것이 없다보니 불안정하고 신뢰도가 높다.

- 불안정성 높음
- 신뢰도 높음
- 유지 보수 어려움
- 실행 속도 느림

## 안티패턴

### 높은 E2E 테스트 비중

- 많은 의존성들을 포함하고 있어서 테스트 실행 속도가 느려진다.
- 어떤 모듈에서 문제를 일으켰는지 확인하기 어려워져서 디버깅이 어려워진다.
- 유지 보수가 어려워진다.

> QA팀이 따로 있진 않아서 공감하진 못함,,

E2E 테스트는 신뢰도가 높아 좋지만 상기 이유로 인해 비용이 많이 드는 테스트다. 최소한으로 유지하자.

### 높은 저수준 테스트 비중

- 빠르게 테스트가 가능하나, 전체적인 시스템이 잘 동작하는지 확인이 어렵다.

### 단절된 고수준, 저수준 테스트

- 여러 테스트가 여러 수준에서 반복적으로 생성됨
- 상기 이유로 불안정하게 되어 신뢰도 하락

## 테스트 레시피 전략

테스트를 어떻게 할 것인지 계획을 세우는 것으로 이 행동부터 했을 때 시나리오에 따라 어떤 테스트 수준이 적합한지 판단하는데 사용할 수 있다.

규칙은 아래와 같다.

- 속도 (저수준 테스트를 우선시)
- 신뢰도 (모든 테스트가 통과되었을 때 잘 동작한다 확신이 들 때까지 시나리오를 만들어라)
- 수정 (테스트를 추가 및 삭제해도 괜찮으나, 레시피를 함께 작성한 사람들에게 공유하라)
- 적절한 타이밍?
- 페어 프로그래밍 (같이 해라)
- 중복 테스트 x
- 여러 계층에 중복 테스트 x
- 더 많이, 더 빠르게
- 실용성 중시

> 2명 이상 ("시니어" 개발자 한 명 포함) 테스트 팀 구성 쉽지 않음
> 그래도 승준님이랑 같이 맨날 머리 싸매고 얘기하니까 좀 나은 것 같네요,,

> 테스트 레시피 전략은 TDD보다 전에 계획을 세우는 것이군요,,

> QA팀이 있는 곳은 어떻게 하시는지요,,?

