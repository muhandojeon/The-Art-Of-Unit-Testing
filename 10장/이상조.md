# 더 나은 테스트 전략 수립

어떤 기능을 어떤 수준에서 테스트할지 어떻게 결정할 수 있을까?  

## 일반적인 테스트 유형과 수준

단위, 컴포넌트, 통합, API, e2e 격리, e2e 통합 순서로 속도가 빠르고 생산성이 높다.  
반대 순서로 신뢰도가 높고 생산성이 낮다.

## 테스트 평가 기준

- 복잡성: 테스트 작성하고 읽고 디버깅하는 과정이 얼마나 복잡한가.
- 불안정성: 제어할 수 없는 요소 때문에 테스트가 실패할 가능성.
- 신뢰도: 테스트가 통과할 때 개발자에게 얼마나 신뢰를 주는지.
- 유지 보수성: 테스트를 얼마나 자주 변경해야 하며, 변경이 얼마나 쉬운지.
- 실행 속도: 테스트가 얼마나 빨리 끝나는지.

### 단위 테스트
단위 테스트와 컴포넌트 테스트는 같은 범주지만 컴포넌트 테스트가 더 많은 함수, 클래스, 컴포넌트를 작업 단위 내에 포함할 수 있다.  
즉, 컴포넌트 테스트는 진입점과 종료점 사이에 더 많은 요소를 포함한다.  

어쨌든 이 둘은 외부 의존성이 없기 때문에 모든 것을 테스트 내에서 제어할 수 있다. 복잡성이 낮고, 불안정성이 낮다. 시스템 전체게 제대로 동작하는지 확신은 없기 때문에 신뢰도는 아쉽다. 유지보수와 실행 속도도 좋다.  

### 통합 테스트
통합 테스트는 단위 테스트와 유사하지만 일부 의존성은 스텁으로 대체할 수 없음. 실제 환경 설정, DB, 파일 시스템 등.  

실제 의존성 수가 많으면 불안정성이 높아진다. 통합 테스트가 통과하면 우리가 제어할 수 없는 요소를 사용하는 코드가 제대로 동작한다는 뜻이기 때문에 신뢰감을 준다. 외부 의존성 사용으로 복잡도가 높다. 외부 의존성으로 인해 단위 테스트보다 느릴 수 있다.  

### API 테스트
배포하여 네트워크를 통해 호출해야 한다. 메모리 내부가 아니라 작업 프로세스 외부에서 하는 테스트.  
네트워크와 배포라는 새로운 의존성.  

네트워크 사용으로 불안정성 높음. 통합 테스트보다도 높은 신뢰감. 네트워크는 복잡도도 높이고, 유지 보수성도 낮춤. 네트워크로 인해 실행 속도가 상당히 느려짐.  

### E2E 격리 테스트
사용자 관점에서 앱을 테스트.  
격리라는 뜻은 우리가 테스트하는 앱이나 서비스만을 대상으로 하고, 이 앱에서 필요한 외부 앱이나 서비스는 배포하지 않고 테스트한다는 의미.  
타사의 인증 절차, 동일 서버에서 배포해야 하는 다른 앱의 API, 테스트 중인 앱에 속하지 않는 모든 코드를 가짜로 만들어 사용.  
다른 팀에서 만든 서비스가 있다면 그것도 가짜로.  

사용하는 의존성이 많아 불안정성 높다. 테스트 통과시 신뢰도를 크게 상승시킴. 의존성이 많아져 유지 보수성이 떨어지고, 길어짐. 실행 속도도 매우 느려진다.  

### E2E 시스템 테스트
모든 것을 진짜로. 실제 운영 환경에 가장 가까운 상태.  

오만 가지 이유로 테스트 실패 가능. 통과하면 가장 높은 신뢰감. 의존성이 많고 작업 흐름이 길어 유지 보수성 좋지 않음. 실행 속도 매우 느림.  

E2E 격리 테스트는 QA나 개발 서버. 실제 운영 환경 의존성 배제. 로그인 기능 테스트하면 모의 서버를 이용하여 인증 절차 검증. E2E 시스템 테스트에서는 스테이징 환경에서 수행. 로그인 기능 테스트하면 실제 인증 서버와 통신하며 검증.


## 각 테스트 수준마다 존재하는 안티 패턴

### E2E 테스트만 사용
이 수준의 테스트는 매우 느리고, 유지보수 하기 어렵고, 디버깅이 힘들며, 불안정성이 높다. 비용은 계속 발생하고, 새로운 테스트 작성에서 얻는 가치는 줄어든다.  

처음 작성할 때는 신뢰감이 높다. 여러 코드를 한 번에 확인, 시스템 간 연결 부분도 함께 검증하기 때문.  
하지만 두 번째 작성할 때는 사실 UI같은 것들이 조금 달라질 뿐이라 첫 번째 테스트에서 얻을 수 있었던 가치 대비 너무 가치가 작다.  
따라서 더 낮은 수준의 테스트를 사용하는 것이 낫다~  

확신과 신뢰감을 주기 때문에 하긴 하되, 수를 최소화 하자.  

### 저수준 테스트만 사용
유닛 테스트는 빠른 결과를 얻을 수 있지만 하나의 통합된 시스템이 잘 동작하는지에 대한 신뢰도는 얻지 못한다.  
테스트가 통과되더라도 앱이 제대로 작동한다고 확신할 수 없다. 결국 테스트 후에도 수동 디버깅을 해야함.  

### 저수준 테스트와 고수준 테스트의 단절
속도를 위한 저수준 테스트, 신뢰를 위한 고수준 테스트 사용하면 이상적인데, 테스트가 단절되어 있으면 예상치 못한 오류나 비효율성이 따라온다.  

- 여러 테스트가 여러 수준에서 반복적으로 생김
- 저수준 테스트와 고수준 테스트 작성하는 사람이 다르다보니 서로의 테스트는 관심 없음.
- 상위 수준과 하위 수준 테스트에서 발생할 수 있는 문제점이 모두 드러난다.

## 테스트 레시피 전략
특정 기능을 어떻게 테스트할지 간단한 계획을 세우는 것.
- 주요 시나리오: 해피 패스
- 예외적인 상황: 에지 케이스

테스트 레시피는 다양한 수준에서 어떤 시나리오 검증할지 계획 -> 실제 테스트 코드는 각 테스트 도구를 잘 활용해서 작성하면 됨.






