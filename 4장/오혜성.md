# 모의 객체를 사용한 상호 작용 테스트
* 목과 스텁의 차이를 알고 잘 사용해라
  + 목: 외부로 나가는 의존성과의 연결 고리를 끊는 데 사용
    - 단위 테스트의 종료점
  + 스텁: 내부로 들어노느 의존성과의 연결 고리를 끊는 데 사용

* 그러니 스텁은 한 테스트에 여러 개일 수 있지만, 목은 하나만 있길 권장

## 비밀번호 검증 함수에 로거가 붙는다면

* 매개변수를 주입하는 방식으로 리팩터링
* 모듈 주입 방식을 이용해 리팩터링

```tsx

const originalDependencies = {
  loggger: require('./logger');
}

let dependencies = {...originalDependencies};

export function resetDependencies() {
  dependencies = {...originalDependencies};
}

export function injectDependencies(fakes) {
  Object.assign(dependencies, fakes);
}

export function verify(...) {
  dependencies.logger.log('foo');
}
```

> 여기서 dependencies는 간접 계층 역할을 함

* 함수형 스타일
  + 커링 스타일
  + 고차 함수 스타일

* 객제 지향 스타일의 목
  + 의존성 주입 스타일
  + 인터페이스 주입 스타일

## 잡설

* 모의 객체나 함수를 만들 때 mock으로 시작하게 작성하는 것을 선호
  + 읽는 사람이 예상할 수 있게

* 커링과 부분 적용 모두 고차 함수를 사용하여 함수를 만드는 것
  + 커링은 하나의 매개변수를 받아 여러 단계에 걸쳐 호출되는 방식
  + 부분 적용은 여러 매개변수를 받는 함수에서 일부 매개변수를 고정한 새로운 함수를 만드는 방식

> 결국 커링도 부분 적용이 가능한 게 아닌가? 이렇게 나눌 필요가 있는건가?

* 인터페이스 이름을 지을 때 헝가리안 규칙을 사용하는 방법
  * 책에서는 인터페이스를 여러 번 구현할 예정이라면 접두사를 붙여 사용 방법을 더 명확히 하는 것이 좋다고 말함

> 난 그렇게 생각하지 않음
> 접두사를 붙여야 인터페이스인 것을 알기 쉬운 환경이라면 구조적으로 문제가 이미 있는게 아닐까? 싶음
> 딱히 인터페이스인지 다른 것인지 알아야 할 때도 잘 없다고 생각하고
>
> 추가적으로 마이크로소프트 타입스크립트 스타일 가이드에서도 사용하지 않는다고 기입되어 있음
> https://github.com/microsoft/TypeScript/wiki/Coding-guidelines
> > 자기들의 컨벤션이라고 말하지만, 만든 사람들이 이렇게 쓴다는 것도 다 생각이 있어서 그런거 아닐까나 ~ 싶음

## 복잡한 인터페이스 다루기

- 다 목으로 만들어서 테스트하려면 중복되는 코드도 많아 번거로움
- 서드 파티 인터페이스라면 시간이 지나면서 테스트가 불안정해질 수 있음
- 내부 의존이라도 긴 인터페이스는 변경될 가능성이 높음 -> 우리가 작성한 테스트도 변경 대상이 됨

### 인터페이스 분리 원칙

- Interface Segregation Principle
- 필요한 것보다 더 많은 기능이 포함되어 있으면, 필요한 기능만 포함된 더 작은 어댑터 인터페이스를 만들어야 함
- 가능한 한 함수를 더 적게 만들고 이름을 더 명확하게 짓고 매개변수를 덜 사용하도록 하면 좋다


### 부분 모의 객체

- 실제 프로덕션 코드를 확장해서 테스트하고 싶은 것만 수정하는 방법
  - 클래스의 메서드를 대체하거나
  - 클래스를 상속해 메서드를 오버라이드하거나

### 내 이야기

- 사내에서 서버 컴포넌트일 때 페이지뷰 로깅을 심는 공통 컴포넌트를 만들어야 할 일이 있었음
- 이때 로깅은 이미 추상화되어 제공되어 있는데, 이게 잘 호출되나 테스트하고 싶었음
  - 딱히 테스트 방법은 spy하는 것 말고 생각이 들지 않아서 작성하진 않음

- 책에서 방법을 알아갈 수 있을까 했는데, 서버 컴포넌트 특성상 적용할 수 있는 방법이 없다고 생각됨
  - 함수를 넘길 수 없기 때문
  - 넘길 수 있다고 해도, DX 관점에서 좋지 않은 방법이라고 생각됨
  - 이전에 공유해주셨던 Provider를 이용한 방법이라면 테스트 가능했을 것이라고 생각
