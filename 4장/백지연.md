# 4장 모의 객체를 사용한 상호 작용 테스트

작업 단위가 가질 수 있는 3가지 종류점
1. 값을 반환하는 것
2. 시스템의 상태를 변경하는 것
3. 서드 파티 함수나 모듈, 객체

> [!IMPORTANT]
> 작업 단위가 서드 파티 함수와 올바르게 상호 작용하는지 어떻게 테스트할 수 있을까?  
> 답은 목에 있다.

## 상호 작용 테스트, 목, 스텁

**상호 작용 테스트**는 작업 단위가 **제어할 수 없는 영역에 있는 의존성과 어떻게 상호 작용하는지 확인**하는 방법이다.  
상호 작용 테스트를 위해서는 목을 사용해야 한다.  
모의 함수나 모의 객체를 사용해 외부 의존성을 제대로 호출했는지 검증할 수 있다.

목과 스텁의 차이는 **정보 흐름**에 있다.  

| 목 | 스텁 |
| :-: | :-: |
| 외부로 나가는 의존성과 연결을 끊음 | 내부로 들어오는 의존성과 연결을 끊음 |
| 종료점 | 경유지 |
| 가짜로 만든 모듈이나 객체 및 함수 | 테스트 코드에 가짜 동작이나 데이터를 제공하는 가짜 모듈, 객체, 함수 |
| 하나의 테스트에 하나의 목 | 하나의 테스트에 여러 스텁 |
| 검증 중요 | 검증 필요하지 않음 |
| 작업 단위의 **요구 사항** | 들어오는 정보나 동작 |
| ex. 로거를 호출한다.<br />이메일을 보낸다. | ex. 데이터베이스 쿼리가 false를 반환한다.<br />특정 설정이 오류를 일으킨다. |

> [!WARNING]
> 목이 여러 개라는 것  
> = 하나의 테스트에서 여러 요구 사항을 테스트한다는 의미  
> → 따라서 목은 테스트당 하나만 사용하는 게 좋다.

> [!NOTE]
> 저자는 모의 함수나 객체의 이름을 `mockXXX`로 짓는다고 한다.

### 목을 작업 단위에 주입하는 방식
- 표준 방식 : 매개변수 추가
- 함수형 방식 : 부분 적용* 또는 팩토리 함수 사용
- 모듈 방식 : 모듈 의존성을 추상화
- 객체 지향 방식 : 타입이 지정된 인터페이스 사용

부분 적용  
여러 매개변수를 받는 함수에서 일부 매개변수를 고정한 새로운 함수를 만드는 방식이다.  
예를 들어 `f(a, b, c)`에서 a와 b를 고정한 새로운 함수 `g(c)`를 만드는 것을 의미한다.  

### 인터페이스 분리 원칙

필요한 기능만 포함된 더 작은 어댑터 인터페이스를 만들어야 한다.  
가능한 한 함수를 더 적게 만들고, 이름을 더 명확하게 짓고, 매개변수를 덜 사용하도록 하면 좋다.

## 부분 모의 객체

객체/함수를 감시(spy)해서 해당 객체/함수가 호출되었는지, 몇 번 호출되었는지, 어떤 인수로 호출되었는지 파악할 수 있다.  
실제 객체 일부를 모의 함수로 변환하면서 나머지 부분은 실제 객체로 유지할 수 있다.  
레거시 코드를 다룰 때 기존 코드와 의존성을 분리해야 할 경우에 유용하다.  
