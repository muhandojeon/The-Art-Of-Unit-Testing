# 단위 테스트의 기초

테스트를 자동화하지 않고, 제대로 돌아가는지 일일이 확인하는 것은 오류도 발생하기 쉽고 시간도 많이 걸린다. 테스트를 자동화하면 이러한 문제들을 해결할 수 있다.

## 진입점과 종료점

> 예제 1-2에서 sum 함수는 totalSoFar 함수를 사용하지 않는데 종료점을 2개 가지고 있다고 표현할까요? ㅇ.ㅇ... number-parser2.js가 2개의 종료점을 가지고 있다고 표현해야 맞는 거 아닐까요?

- 코드의 설계 방향: 쿼리는 상태를 변경하지 않고 오직 값을 반환한다. 명령은 상태를 변경하지만 값은 반환하지 않는다.

> 이거 보고 useQuery랑 useMutation이 생각났는데요, useMutation에 사용된 mutate 함수가 반환해주는 값을 사용하곤 했는데 이게 좋지 않은 패턴일까요? 아니면 제가 명령이랑 useMutation을 연관 지은 것이 잘못된 걸까요?
> 조금 찾아보니까 이러한 걸 [CQS 원칙(Command Query Separation)](https://martinfowler.com/bliki/CommandQuerySeparation.html)이라고도 하네요. 무려 2005년에 마틴 파울러 형이 쓴 글이 있네요.

## 처음부터 테스트 코드 작성

- 빌트인 assert 함수

> Node.js에는 내장 함수로 assert가 있는데요, 브라우저 단에서는 [console.assert](https://developer.mozilla.org/ko/docs/Web/API/console/assert_static)를 사용하면 조금이나마 대체할 수 있을 것 같네요. console.assert라는 것이 있는 줄도 몰랐다능.

## 좋은 단위 테스트의 특징

대부분은 단위 테스트를 작성하려다 포기하거나 애초에 작성할 생각조차 하지 않는다. 잘못된 방식으로 테스트를 작성하느라 많은 시간을 낭비하고, 유지보수하는 데에 더 많은 시간이 걸릴 것이라고 예상하기 때문이다.

> 지금 딱 제가 겪었던 상황이네요. 단위 테스트가 아니라 e2e 테스트였긴 한데, 어차피 기획 바뀌면 또 e2e 테스트를 수정해야 되니까 의미가 있을까? 싶기도 하고 귀차니즘이 커져서 내버려둔 상황이에요. 단위 테스트부터 차근차근 쌓아올려보는 것이 좋을까요?

단위 테스트에는 스텁을 사용하고, 통합 테스트에는 실제 데이터 베이스를 사용하는 것이 좋다.

> 책에서 이유를 말해주진 않은 것 같은데, 왜 이렇게 표현했을까요? 말그대로 통합해서 기능이 제대로 동작하고 있는지 살펴보겠다는 걸까요? 그렇다면 로컬에서 통합 테스트를 돌릴 때 참 귀찮지겠네요 호호!

## 좋은 단위 테스트의 특징

- 단위 테스트 체크리스트

> 결국 테스트 코드가 빠른지, 작성하기 쉬운지, 독립적인지 체크하면 되는 것으로 느껴졌어요.

## 통합 테스트

- 레거시 코드의 정의

`테스트 코드가 없는 코드를`를 레거시 코드의 공식 정의로 사용하며, 이 정의를 염두에 두고 이 책을 읽어 보면 도움이 될 것이다.

> 이전에 생각치 못했던 관점 같아서 신기했어요. 앞으론 테스트 코드가 없어서 쉽게 수정하기 어려운 코드를 레거시 코드라고 생각해볼 예정입니다.

- 하나의 테스트를 삭제, 이동, 변경해도 다른 테스트는 영향받지 않고 잘 실행되는가?
  - 여러 테스트가 값을 공유할 때는 테스트를 정해진 순서대로 실행하지 않으면 결과가 올바르게 나오지 않을 수 있다.

> 그래서 e2e 작성할 때 beforeEach에서 테스트 환경(특히 데이터베이스)을 초기화해주는 [seed 작업](https://breathof.tistory.com/268)을 항상 수행했었네요. 그리고 병렬로 돌리지 않았습니다 ㅎㅎㅎ

## 테스트 주도 개발

1. 실패하는 테스트를 작성
2. 구현하며 테스트를 통과
3. 리팩토링

TDD를 하면 테스트가 실패하는 과정과 통과하는 과정을 모두 겪는다. 코드를 작성하기 전에 테스트가 실패하는 것을 확인함으로써, 이후에 해당 기능이 제대로 동작하지 않을 때 테스트가 처음 의도한 대로 실패한다는 사실에 마음을 기댈 수 있다.

> 시간이 있음에도 TDD를 시도조차 안했던 이유는 테스트 코드 작성 자체가 서툴렀기 떄문인 것 같아요. 그래서 이걸 TDD로 하면 시간이 더 걸리지 않을까?라는 우려 때문에 안해봤는데 이번 주엔 한 번 시도해보겠습니다.
