# 단위 테스트의 기초
* 단위 테스트는 1970년대 스몰토크에서 시작됨
  + 켄트 백 아저씨가 도입

> 익스트림 프로그래밍(XP) https://namu.wiki/w/%EC%9D%B5%EC%8A%A4%ED%8A%B8%EB%A6%BC%20%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D
> tidy first? 로도 유명한 아저씨

## 진입점과 종료점

* 함수의 선언과 서명(시그니처)는 진입점
* 반환하는 것, 다른 상태를 변경하는 것, 서드 파티 코드를 호출하는 것 등이 종료점

* 쿼리와 명령
  + 쿼리는 상태를 변경하지 않고 값만을 반환
  + 명령은 상태를 변경하지만 값은 반환하지 않음
  + 보통은 이 둘을 자주 결합해 사용하지만, 두 액션을 분리해 설계하는 것이 나을 때가 많다고 함

* 종료점마다 테스트를 만들어 분리하면 각 테스트끼리 영향을 주지 않고, 더 읽기 쉬우며, 디버깅하기도 쉽다

* 직접 입출력과 간접 입출력
  + 함수 시그니처, 호출, 반환은 직접 입출력
  + 간접 출력은 상태 값 변경, 서드 파티 코드 호출 등으로 이해됨

* 서드 파티를 호출하는 종료점을 테스트하기 위해
  + Mock을 만들어 할 수 있음
  + 저자는 전체 테스트 중 Mock을 이용한 테스트는 5%가 넘지 않다고 말함
  + mock을 이용한 테스트는 복잡성을 증가시키고 유지 보수를 어렵게 만들기 때문

> 근데 현실 세계의 리액트 컴포넌트를 테스트한다면 (단위 테스트가 아니겠지만?)
> 어쩔 수 없이 많이 써왔던 것 같은 (구체적인 사례는 기억안나지만)
> 여러분을은 Mock, Spy 같은 것들을 많이 하셨었나요

## 테스트 작성

* Node는 빌트인 assert를 제공

## 좋은 단위 테스트의 특징

* 단위 테스트를 효율적으로 작성하지 않으면 득보다 실이 많을 수 있음

### 좋은 단위 테스트란

* 테스트 작성자의 의도를 이해하기 쉬워야 함
* 읽고 쓰기 쉬어야 함
* 테스트를 자동화할 수 있어야 함
* 같은 조건에서 같은 실행 결과
* 의미 있는 테스트여야 하고, 구체적인 결과를 제공해 문제를 쉽게 파악하고 해결할 수 있어야 함
* 누구나 쉽게 실행
* 실패할 경우 무엇이 잘못되었는지 쉽게 알 수 있어야 함
* 빠르게 실행되어야 함
* 테스트 환경 일관성, 예측 가능성
* 다른 테스트와 완전히 독립적으로 실행
* 메모리 내에서만 실행되어야 함
* 가능한 동기적인 흐름으로 실행

* 테스트가 제대로 통과하는지를 언젠가 수동으로 다시 확인해야 하는 테스트는 좋지 않다

> 위 내용이 jsdom에 대해 시작됐는데, 
> 최근에 알아봤을 때는 DOM API를 재현하는 도구 중에서는 가장 완성도가 높다고 그러더라구요
> happy-dom이라고도 있는데
> https://github.com/capricorn86/happy-dom
> jsdom 보다는 빠르지만 지원하지 않는게 있어서 아직 jsdom이 정배인 생태계이더라구요
> https://github.com/vitest-dev/vitest/discussions/1607

## 통합 테스트

* 통합 테스트는 실제 의존성(API, 데이터베이스, 네트워크 등)을 사용하고
* 단위 테스트는 작업 단위를 의존성에게 격리시켜 항상 일관된 결과를 받을 수 있는 것

* 회귀
  + 코드를 변경한 후 이전에 잘 돌아가던 테스트를 실행할 수 없게 되면 코드에 버그가 생겨도 알아차리지 못함 < 이거
  + 이전에 동작하던 기능이 지금은 동작하지 않는 것
  > 잘 이해한 게 맞나 모르겠음

* 레거시 코드
  + 대다수가 테스트 코드가 없는 코드로 정의

> https://jbee.io/articles/book/%EC%B6%94%EC%B2%9C%ED%95%98%EB%8A%94%20%EC%B1%85%205%EA%B6%8C, %20%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4%20%EA%B0%9C%EB%B0%9C%ED%8E%B8
> https://tosspayments-dev.oopy.io/66bd4494-792a-4137-82bc-57eb41f32345

## 최종 정리

* 단위 테스트는 진입점을 통해 작업 단위를 호출한 후 그 종료점을 확인하는 자동화된 코드다.
* 단위 테스트는 거의 항상 단위 테스트 프레임워크를 사용하여 쉽게 작성할 수 있고 빠르게 실행 할 수 있다.
* 잘 작성된 단위 테스트는 신뢰성이 높고 가독성도 좋아서 유지 보수하기에 용이하다.
* 우리가 운영하는 코드가 변경되지 않는 한 동일한 결과를 보장한다.

* **가독성, 유지 보수성, 신뢰성**

* 단순한 속성이나 데이터도 작업 단위의 일부로 사용되어 단위 테스트에 포함
  + 하지만 단순한 부분까지 특별히 테스트할 필요는 없음

> 컬러 토큰(팔레트)가 있고, 이를 이용해 제공하는 css var이 있는 경우는 테스트할 가치가 있을까?
> red: #123
> --color-red: #123 << 이게 나오는지
> 저는 있다고 생각해, 이전 회사에서 스냅샷 테스트를 돌리곤 했음
> https://vitest.dev/guide/snapshot

## 테스트 주도

* 경력 전반에 걸쳐 TDD가 질 좋은 코드와 테스트, 코드 설계를 만드는 데 도움이 된다고 느꼈음

* TDD를 올바르게 사용하면 코드 품질이 크게 향상, 버그가 줄어들고, 코드에 대한 자신감이 높아지고, 버그를 찾는 시간이 단축되고, 코드 설계가 개선되고, 관리자 만족도가 높아진다
  + 하지만 잘못 사용하면 프로젝트 일정이 밀리고, 시간 낭비가 발생하고, 동기 부여가 떨어지고, 코드 품질이 낮아질 수 있다

> 신입은 어디서 경력 쌓냐 ~ 와 비슷한 느낌 ㅋㅋㅋ
> 꼭 TDD로 해야하는 사이드 프로젝트? 같은게 있으면 숙련도를 올리기 재밋긴 할듯

> 떠오른 것들 공유
> 테스트에 사용될 수 있는 가짜 데이터를 모아둔 라이브러리: https://github.com/faker-js/faker
>  
> (높은 확률로 다른 분이 하셨겠지만) jest API를 100% 지원하고, 더 빠른 https://vitest.dev/
> 이번에 v3가 나오면서 브라우저 모드도 되고, playwright 기반으로 여러 브라우저에서도 돌릴 수 있다고 하더라고요
> https://vitest.dev/blog/vitest-3
>
> 저는 [estoolkit](https://github.com/toss/es-toolkit)이나 [rooks](https://github.com/imbhargav5/rooks) 같은 소스보면서 테스트 코드 작성에 많이 참고했어용
