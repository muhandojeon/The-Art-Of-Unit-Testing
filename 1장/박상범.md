# 1장 단위테스트의 기초



## 1.2 단위 테스트의 정의

- 단위 테스트의 단위는 작업 단위를 뜻하고 이는 진입점 + 종료점을 의미
- 즉, 함수나 모듈, 컴포넌트 정도를 의미

## 진입점과 종료점

- 그럼 작업 단위에서 의미있는 작업은? 종료점 이라고 함
  - 행동이라고 안하고 종료점 이라고 표현한건 좀 더 유동적인 형태를 의미하기 위함이라고 함
  - 이는 작업 단위의 최종 결과기도 함 

## 1.4 종료점 유형

예제에서 세 유형의 종료점을 가지고 있었는데 각 종료점마다 테스트를 만들어 분리하는게 코드 관리 측면에서 유리하다고 함

테스트 방법은 아래와 같음

- 반환 값이 있는 종료점: 진입점 호출, 실행 결과 값 받아서 그 값 확인
- 상태 값 변경하는 종료점: 어떤 것 호출 후 다른 것 호출해서 확인하기, 이전 것 호출 후 다시 호출해서 의도대로 흘러갔는지 확인하기
- 서드 파티 호출하는 종료점: 모의 객체 만들어서 테스트 결과 임의로 조작하기

> 여기서 집필자는 모의 객체를 사용하는 테스트는 피하려고 애쓴다고 함.  
왜냐면 모의 객체를 사용한 테스트는 복잡성을 증가시키고 유지보수 어렵게 만든다고 한다..   
예시가 없어서 난 잘 모르겠다~

## 1.7 좋은 단위 테스트의 특징

왜 좋은 테스트를 작성해야 하는지 확실한 이유를 알고 있어야 한다!

좋은테스트의 특징과 좋은 단위 테스트의 특징이 있는데 다 만족하는건 불가능에 가깝다고 함   

단위 테스트 조건을 만족하기 까다롭다면? 적당한 리팩토링을 거쳐서 많은 조건을 충족 시키게 하는 방법도 있고, 통합 테스트로 만들어서 테스트하는 방법도 있다고 함

## 데이터베이스나 다른 의존성을 스텁으로 대체하기

> 이건 단위테스트 이야기는 아니지만.. 최근 과제테스트에서 요구사항 전부를 테스트하는 시나리오를 작성한 적이 있었음   
> api를 통해 서버에 요청하면 실제 db에 쌓였고, 이로 인해 호출한 데이터가 없을 때의 시나리오는 처음에만 통과하고 이후엔 계속 실패하는 상황이 발생했음    
> 그래서 실제 서버에 요청을 하지 않고 spyOn을 통해 api 함수를 스파잉해서 호출 인터셉트 하고 서버 응답 데이터를 목데이터로 반환 시킴. 이후엔 잘 호출되는지 테스트 했음   
> 이렇게 했었던 이유는 통합 테스트의 주요 목적이 [api 서버 검증이 아니라, api를 통해 전달된 데이터를 처리하는 컴포넌트들의 동작을 검증하는 것](https://techblog.woowahan.com/19509/#:~:text=%ED%86%B5%ED%95%A9%20%ED%85%8C%EC%8A%A4%ED%8A%B8%EC%9D%98%20%EC%A3%BC%EC%9A%94%20%EB%AA%A9%EC%A0%81%EC%9D%80%20%EC%9B%B9%20API%20%EC%84%9C%EB%B2%84%EB%A5%BC%20%EA%B2%80%EC%A6%9D%ED%95%98%EB%8A%94%20%EA%B2%83%EC%9D%B4%20%EC%95%84%EB%8B%88%EB%9D%BC%2C%20API%EB%A5%BC%20%ED%86%B5%ED%95%B4%20%EC%A0%84%EB%8B%AC%EB%90%9C%20%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC%20%EC%B2%98%EB%A6%AC%ED%95%98%EB%8A%94%20%EC%95%A0%ED%94%8C%EB%A6%AC%EC%BC%80%EC%9D%B4%EC%85%98%EC%9D%98%20%EB%8F%99%EC%9E%91%EC%9D%84%20%EA%B2%80%EC%A6%9D%ED%95%98%EB%8A%94%20%EA%B2%83%EC%9E%85%EB%8B%88%EB%8B%A4.%20%EC%8B%A4%EC%A0%9C%20%EC%84%9C%EB%B2%84%EA%B0%80%20%ED%85%8C%EC%8A%A4%ED%8A%B8%20%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C%20%ED%95%84%EC%9A%94%ED%95%98%EC%A7%80%20%EC%95%8A%EA%B8%B0%20%EB%95%8C%EB%AC%B8%EC%97%90%2C%20%EC%84%9C%EB%B2%84%20%EC%9D%91%EB%8B%B5%20%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC%20%EB%AA%A8%ED%82%B9%ED%95%98%EC%97%AC%20%EB%8B%A4%EC%96%91%ED%95%9C%20%EC%84%9C%EB%B2%84%20%EC%9D%91%EB%8B%B5%20%EA%B2%B0%EA%B3%BC%EC%97%90%20%EB%94%B0%EB%A5%B8%20%EC%B2%98%EB%A6%AC%20%EA%B3%BC%EC%A0%95%EC%9D%84%20%ED%85%8C%EC%8A%A4%ED%8A%B8%ED%95%A0%20%EC%88%98%20%EC%9E%88%EC%8A%B5%EB%8B%88%EB%8B%A4)이라고 알고있었기 때문   
> 이를 통해, 나는 서버나 네트워크에 영향 받지 않는 테스트를 작성할 수 있었음       

## 비동기 처리를 동기적 테스트로 흉내내기

비동기 코드를 동기적인 방식으로 검증하기

> 비동기적으로 동작하는 컴포넌트나 프로미스 결과를 기다려주고 넘긴 콜백의 실행을 하는 react testing library의 await waitFor() 가 생각났음

## 1.8 통합 테스트

통합 테스트는 좋은 단위 테스트 조건 중 하나라도 충족하지 못하는 모든 테스트를 의미한다고 함 e.g) 실제 네트워크, 실제 rest api, 실제 db 사용하면 통합테스트에 해당

> 그럼 API 함수들을 완전히 모킹하고 호출을 감시하면서 UI와 상태 변화 등 전체적인 흐름을 검증하면 통합 테스트가 아니라는 말인가?   
> 아니라 생각. 책에서 말하는건 그냥 전통적인 통합테스트의 의미 정도로 생각했음.. 통합 테스트의 본질은 시스템 간 상호작용을 검증하는 것이지, 실제 의존성을 강제하는 것이 아니라고 생각함...

요약하자면 통합 테스트는 실제 의존성을 사용하고, 단위 테스트는 작업 단위를 의존성에서 격리 시켜 항상 일관된 결과를 받을 수 있도록 하여 작업 단위의 모든 측면을 쉽게 조작할 수 있게 한다.

> 통합 테스트는 실제 의존성을 사용해야 된다? => 요거에 대한 다른분들의 의견이 궁금합니다.. 


## 1.9 최종 정리

- 단위 테스트는 진입점을 통해 작업 단위를 호출한 후 그 종료점을 확인하는 자동화된 코드
- 단위 테스트는 거의 항상 단위 테스트 프레임워크를 사용하여 쉽게 작성할 수 있고 빠르게 실행 할 수 있음 
- 잘 작성된 단위 테스트는 신뢰성이 높고 가독성도 좋아서 유지 보수하기에 용이. 우리가 운영하는 코드가 변경되지 않는 한 동일한 결과를 보장


## 테스트 주도 개발

- TDD : 테스트 우선 개발
  - TDD를 올바르게 사용하면 코드 품질이 크게 향상되고, 버그가 줄어들고, 코드에 대한 자신감이 높아지고, 버그를 찾는 시간이 단축되고, 코드 설계가 개선되며, 관리자 만족도가 높아진다!
  - TDD를 잘못 사용하면 프로젝트 일정이 밀리고, 시간 낭비가 발생하고, 동기 부여가 떨어지고, 코드 품질이 낮아질 수 있다.
  - 양날의 검과 같음. 많은 사람이 직접 어려움을 겪으면서 깨달음
  - TDD의 큰 장점은 테스트 정확성 검증임. 코드 작성 전에 테스트 실패하는 것을 확인하고, 이후 코드가 추가&수정 될 때 테스트가 기능을 정확히 검증한다는 것을 확인해야 됨


![스크린샷 2025-02-11 오전 12 16 38](https://github.com/user-attachments/assets/edf35861-add0-43f4-942a-a38d0a891b35)

