### 1.1 누구에게나 처음은 있다.

- 단위 테스트
- 통합 테스트
- 테스트 주도 개발

### 1.2 단위 테스트 정의

- 단위 테스트는 컴퓨터 프로그래밍에서 예제 코드의 특정 모듈이 의도된 대로 정확히 작동하는지 검증하는 절차다. 즉, 모든 함수와 메서드에 대한 테스트 케이스를 작성하는 절차를 말한다. 이를 통해서 언제라도 코드 변경으로 인해 문제가 발생할 경우, 단시간 내에 이를 파악하고 바로 잡을 수 있도록 해 준다. 이상적으로, 각 테스트 케이스는 서로 분리되어야 한다.
- 단위란?
  - 시스템 내 작업 단위, 또는 사용 사례
  - 단위에는 시작과 끝이 있으며 이것을 진입점과 종료점이라고 한다.

### 1.3 진입점과 종료점

- 의미 있는 작업이란
  - 단순히 값을 반환하는 것부터 시작하여 어떤 상태를 변경하거나 서드 파티 코드를 호출하는 등 뭔가 눈에 띄는 동작
- 코드의 설계 방향
  - 쿼리 - 상태를 변경하지 않고 오직 값을 반환
  - 명령 - 상태를 변경하지만 값은 반환하지 않음
- 각 종료점마다 테스트를 만들어 분리하면 각 테스트끼리 영향을 주지 않고 더 읽기 쉬우며 디버깅하기도 쉽다.

### 1.4 종료점 유형

### 1.5 다른 종료점, 다른 기법

- **반환 값이 있는 종료점**
  - **작업 단위를 실행하여 진입점을 호출하고 실행 결과값을 받아 그 값을 확인**
- **상태 값을 변경하는 종료점**
  - **어떤 것을 호출한 후 다른 것을 호출하여 무언가를 확인하거나, 이전에 호출한 것을 다시 호출하여 모든 것이 의도대로 흘러갔는지 확인**
- **서드 파티를 호출하는 종료점**
  - **모의 객체를 만들어 테스트 결과를 임의로 조작하는 방법**


### 1.6 처음부터 테스트 코드 작성

- jest 프레임워크 없이 직접 테스트 코드를 작성한 예시

### 1.7 좋은 단위 테스트의 특징

- 좋은 단위 테스트란?
  - 테스트 작성자 의도를 이해하기 쉬워야 한다.
  - 읽고 쓰기 쉬워야 한다.
  - 테스트를 자동화할 수 있어야 한다.
  - 같은 조건에서 실행 결과는 항상 같아야 한다.
  - 의미 있는 테스트여야 하고, 구체적인 결과를 제공하여 문제를 쉽게 파악하고 해결할 수 있어야 한다.
  - 누구나 쉽게 실행할 수 있어야 한다.
  - 실패할 경우 무엇이 잘못되었는지 쉽게 알 수 있어야 한다.
  - 빠르게 실행되어야 한다.
  - 테스트 환경을 일관되게 유지하고 테스트 결과가 항상 예측 가능해야 한다.
  - 다른 테스트와 완전히 독립적으로 실행되어야 한다.
  - 시스템 파일, 네트워크, 데이터 베이스가 없어도 메모리 내에서 실행되어야 한다.
- 데이터베이스나 다른 의존성을 스텁으로 대체하기
  - 스텁: 실제 의존성을 흉내내는 가짜 의존성
- 비동기 처리를 동기적 테스트로 흉내 내기
- 단위 테스트 체크리스트
  - 2주, 2개월, 2년 전에 만든 테스트가 여전히 잘 돌아가는가?
  - 내가 2개월 전에 작성한 테스트를 팀 내 다른 동료가 실행했을 때, 문제없이 결과를 받을 수 있는가?
  - 내가 만든 테스트가 수분 내로 전부 실행되는가?
  - 버튼 하나만 눌러서 내가 작성한 모든 테스트를 실행할 수 있는가?
    - **사용자 관점에서 귀찮으면 안된다.**
  - 기본적인 테스트를 몇 분 내로 작성할 수 있는가?
  - 다른 팀 코드에 버그가 있어도 내 테스트는 통과하는가?
  - 내 테스트는 다른 실행 환경에서 실행해도 동일한 결과를 보장하는가?
  - 데이터베이스나 네트워크, 배포 없이도 내 테스트는 동작하는가?
  - 하나의 테스트를 삭제, 이동, 변경해도 다른 테스트는 영향을 받지 않고 잘 실행되는가?
    -> 단위테스트는 독립성을 가진다.

### 1.8 통합 테스트

- 테스트가 실제 네트워크, 실제 REST API, 실제 시스템 시간, 실제 파일 시스템 또는 실제 데이터베이스를 사용한다면 이는 통합 테스트
- 단위 테스트에서 검증하지 못하는 시스템 전체의 상호 작용을 확인할 수 있는 중요한 역할
- 단위 테스트와 분리되어야 안전한 그린 존을 유지할 수 있다.
- 중요한 포인트
  - 가독성
  - 유지보수성
  - 신뢰성

### 1.9 최종 정리

- 단위 테스트는 진입점을 통해 작업 단위를 호출한 후 그 종료점을 확인하는 자동화된 코드다. 단위 테스트는 거의 항상 단위 테스트 프레임워크를 사용하여 쉽게 작성할 수 있고 빠르게 실행할 수 있다. 잘 작성된 단위 테스트는 신뢰성이 높고 가독성도 좋아서 유지 보수하기에 용이하다. 우리가 운영하는 코드가 변경되지 않는 한 동일한 결과를 보장한다.

### 1.10 테스트 주도 개발

- 테스트를 먼저 작성한다고 해서 가독성도 좋고 유지 보수도 쉬운 테스트를 만들 수 있는 것은 아니다.
- 테스트가 읽기 쉽고 유지 보수 가능하다고 해도 테스트부터 시작하는 TDD 장점까지 얻을 수 있는 것은 아니다.
- 테스트를 먼저 작성하고 그 테스트가 읽기 쉽고 유지 보수 가능하다고 해서 좋은 설계를 바탕으로 코드를 만들었다는 의미는 아니다.

### 느낀점

- 테스트 코드를 작성할 때 많이 들리는 고민
  - e2e 테스트의 경우 도메인 로직이 들어가게 되면 나중에 또 결국 테스트 코드를 바꿔야 한다는 문제점 때문에 테스트 작성을 미루게 되고 안하게 되는 경우가 많은 것 같다.
  - 그렇다면 애초에 도메인 로직을 분리한 코드를 작성하는 것부터가 선행되어야 할 것이다.
  - 어떻게? 결국 TDD를 해야하나?

- 예전에 부트캠프에서 수강생 과제를 제작할 때, 완성된 프로젝트에 빈 칸 뚫어놓고 각각의 빈 칸에 테스트를 설치한 후 수강생들은 빈 칸을 채우고 테스트 돌리는 형식으로 과제를 제작했었다.
  - 그 때 테스트 코드를 몇 번 작성해 보고 그 이후로 회사에서 작성한 적은 거의 없었던 것 같은데..
  - 대부분의 빈 칸은 **반환 값이 있는 종료점**을 기준으로 작업 단위를 실행하여 진입점을 호출하고 실행 결과값을 받아 그 값을 확인하는 테스트였고
  - OAuth 관련된 과제를 만들 때, mock api 같은 서드 파티를 호출해서 테스트를 작성한 기억이..나서 찾아보니 관련 라이브러리도 있네. [oauth2-mock-server](https://www.npmjs.com/package/oauth2-mock-server)