# 단위 테스트의 기초

## 단위 테스트란?

- 특정 모듈 혹은 코드가 의도된 대로 정확히 작동하는지 검증하는 절차

## 진입점과 종료점

진입점의 경우 테스트 대상 함수 혹은 모듈이 시작되는 지점으로, 테스트에선 함수를 호출하여 코드의 실행을 시작하는 부분

종료점의 경우 함수의 실행 후 나타나는 **모든 결과**(반환 값, 부수 효과, 예외 발생 등)를 의미

> totalSoFar의 코드가 있는 부분을 기준으로 sum 함수를 호출하며 진입, 종료점 즉, 반환 값 혹은 부수효과가 나타나는 부분은 총 2군데로 테스트 코드 작성 시 검증해야 하는 부분이라 볼 수 있다.

> 5번 정도 읽어보다가 갑자기 이해된 부분,, (사실 잘못 이해했을지도,,?)


### 쿼리, 명령

쿼리는 상태 변경 x 값만 반환
명령은 상태 변경 o 값 반환

> getter와 setter의 느낌이라 대충 이해하면 되겠죠?
> 더불어 쿼리와 명령을 분리해서 설계한다면 쿼리 부분은 종료점이 1개 정도로 명확하다 볼 수 있고, 명령의 경우 값을 반환하는 부분이 아닌 다른 부수효과를 일으킬 수 있다는 것을 암묵적으로 표현할 수 있다(?)

## 다른 종료점, 다른 기법

종료점마다 테스트를 만들어 분리하는 것은 테스트 코드 관리에 용이하다.

로거가 포함된 예시 코드의 경우 한 테스트에 모두 작성하게되면 반환값도 확인하고, 로깅도 확인하고, 부수효과도 확인해야한다.

특히 로깅과 같이 외부 모듈에 의존하는 경우 직접적인 확인이 어렵기에 해당 모듈에서 테스트를 위한 환경을 구축해주거나 모킹을 통해 테스트 환경을 직접 구축해줘야 한다.

> 해당 모듈에서 테스트를 위한 환경을 구축한 예시(?)는 [nuqs testing](https://nuqs.47ng.com/docs/testing) 문서라고 대충 생각함

## 좋은 단위 테스트의 특징

처음에 팩폭을 때리지만 부정할 수 없었음 , ,

- 테스트 작성자 의도를 이해하기 쉬워야 한다.
- 읽고 쓰기 쉬워야 한다.
- 테스트를 자동화할 수 있어야 한다.
- 같은 조건에서 실행 결과는 항상 같아야 한다.
- 의미 있는 테스트여야 하고, 구체적인 결과를 제공해 문제를 쉽게 파악, 해결할 수 있어야 한다. (굳이 안 해도 되는 거 말고 올바른 테스트 쿼리를 사용해야함)
- 누구나 쉽게 실행할 수 있어야 한다.
- 실패할 경우 무엇이 잘못되었는지 쉽게 알 수 있어야 한다. (테스트를 적당하게 잘 나누어 종료점마다 테스트 작성해야함)
- 빠르게 실행되어야 한다. (vitest 쓰십시오.)
- 테스트 환경이 일관되어야 한다.
- 다른 테스트와 완전히 독립적으로 실행되어야 한다.
- 시스템 파일, 네트워크, 데이터베이스가 없어도 메모리 내에서 실행되어야 한다. (모킹해야한다)
- 동기적인 흐름으로 실행되어야 한다. ([playwright test-parallel](https://playwright.dev/docs/test-parallel)과는 다른 얘기겠죠?)

setup과 teardown을 잘 하자?,,

## 통합테스트

통합 테스트는 한 번에 많은 곳을 테스트함

## 정리

단위 테스트는 진입점을 통해 작업 단위를 호출한 후 종료점을 확인하는 자동화된 코드.

운영 코드를 변경하지 않는 한 동일한 결과를 보장한다.

## TDD

개발 후 테스트를 작성하면 PR Merge를 목적으로하는 테스트 코드가 작성될 가능성이 높다.

> TDD나 테스트 자체를 팀 차원에서 누군가 배워 도입 or 떠먹여줬으면 하는 바람이 있으나, 그럴 일은 없기에 직접 배우는 중,,
> 아자아자 화이링,, 대승준 화이링,,

### TDD 실전편

- 구현 전 실패하더라도 기능 구현을 검증하는 테스트 코드 작성
- 테스트를 통과할 수 있도록 기능 구현
- 코드 리팩토링

### TDD의 효능

- 코드 품질 향상
- 버그 감소
- 자신감 상승
- 버그 찾는 시간 단축
- 코드 설계 개선
- 관리자 만족도 상승
- 투자 성공

### TDD의 부작용

- 프로젝트 일정 밀림
- 시간 낭비
- 동기 부여 감소
- 코드 품질 감소
- 야근

> 기능 구현으로 테스트 자체를 검증하는 건 새로운 시각이네요.

### 코드 작성 후 테스트 작성

되게 큰 단점으로는 현재 구현에 맞게끔 테스트 코드를 작성하다보니 예외 케이스를 많이 생각하지 못하는 것 같더라고요.

### TDD 잘하는 방법

- 좋은 테스트 작성 방법 알아오기
- 테스트부터 작성하기
- 원칙에 따라 설계하기

> 다음 스터디는 테스트 주도 개발인 것인가요?